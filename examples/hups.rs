use rusqlite::Connection;
use pkcore::analysis::store::db::headsup_preflop_result::HUPResult;
use pkcore::analysis::store::db::sqlite::Sqlable;
use pkcore::bard::Bard;

/// OK, so these results are completely foobared.
///
/// ```txt
/// /home/gaoler/.cargo/bin/cargo run --color=always --package pkcore --example hups
///     Finished dev [unoptimized + debuginfo] target(s) in 0.05s
///      Running `target/debug/examples/hups`
/// K♠ K♦ (137438955520) __ __ (37210) ties: (37210)
/// K♥ 6♦ (268435584) __ __ (1090190) ties: (610489)
/// K♥ 6♦ (268435584) 3♣ 2♣ (1090190) ties: (610489)
/// A♠ 5♦ (412316860416) __ __ (406764) ties: (1228716)
/// Q♦ J♦ (70369012613120) 4♣ 2♣ (1198761) ties: (498275)
/// Q♦ J♦ (70369012613120) 4♣ 3♣ (1198761) ties: (498275)
/// 9♠ 6♣ (67239936) 4♣ 3♣ (1136466) ties: (393246)
/// 8♣ 5♣ (3221225472) __ __ (906176) ties: (729584)
/// ...
/// ```
///
/// Oopsie... forgot that there's an index column.
///
/// Much better:
///
/// ```
/// /home/gaoler/.cargo/bin/cargo run --color=always --package pkcore --example hups
///      Finished dev [unoptimized + debuginfo] target(s) in 0.05s
///       Running `target/debug/examples/hups`
///  K♠ K♦ (37210) K♥ K♣ (37210) ties: (1637884)
///  K♥ 6♦ (1090190) 9♣ 4♥ (610489) ties: (11625)
///  K♥ 6♦ (1090190) 9♣ 4♥ (610489) ties: (11625)
///  A♠ 5♦ (406764) A♥ K♥ (1228716) ties: (76824)
///  Q♦ J♦ (1198761) 9♠ 4♥ (498275) ties: (15268)
///  Q♦ J♦ (1198761) 9♠ 4♥ (498275) ties: (15268)
///  9♠ 6♣ (1136466) 6♦ 2♥ (393246) ties: (182592)
///  8♣ 5♣ (906176) 7♥ 6♥ (729584) ties: (76544)
///  8♣ 5♣ (906176) 7♥ 6♥ (729584) ties: (76544)
///  A♣ J♣ (1306006) J♠ 4♦ (371480) ties: (34818)
///  9♥ 8♣ (1167973) 8♦ 4♠ (375087) ties: (169244)
///  9♣ 6♥ (1087052) 8♠ 2♦ (571517) ties: (53735)
///  A♣ 6♦ (1097655) Q♣ 4♦ (605610) ties: (9039)
///  A♣ 6♦ (1097655) Q♣ 4♦ (605610) ties: (9039)
///  8♥ 3♥ (565408) 4♠ 4♦ (1112948) ties: (33948)
///  8♥ 3♥ (565408) 4♠ 4♦ (1112948) ties: (33948)
///  9♥ 4♦ (355331) 9♣ 7♣ (914489) ties: (442484)
///  A♥ A♦ (1482914) T♠ 3♣ (223608) ties: (5782)
///  A♥ A♦ (1471755) K♠ 9♣ (235580) ties: (4969)
///  A♦ T♥ (1103562) Q♦ 6♣ (601815) ties: (6927)
///  A♦ T♥ (1103562) Q♦ 6♣ (601815) ties: (6927)
///  T♠ 2♠ (452579) T♥ 5♣ (544984) ties: (714741)
///  T♠ 2♠ (452579) T♥ 5♣ (544984) ties: (714741)
///  J♣ 8♦ (978884) T♣ 9♦ (709309) ties: (24111)
///  J♣ 8♦ (978884) T♣ 9♦ (709309) ties: (24111)
///  K♠ 2♦ (943391) 9♠ 7♥ (756364) ties: (12549)
///  K♠ 2♦ (943391) 9♠ 7♥ (756364) ties: (12549)
///  Q♥ T♦ (1137685) 4♦ 2♥ (556894) ties: (17725)
///  A♦ 2♦ (1068463) Q♣ 5♥ (635502) ties: (8339)
///  A♦ 2♦ (1068463) Q♣ 5♥ (635502) ties: (8339)
///  A♦ 8♠ (1060244) 6♣ 2♣ (644639) ties: (7421)
///  A♦ 8♠ (1060244) 6♣ 2♣ (644639) ties: (7421)
///  8♥ 4♥ (825134) 3♥ 3♦ (851518) ties: (35652)
///  T♠ 3♥ (940070) 9♣ 7♠ (737424) ties: (34810)
///  T♠ 3♥ (940070) 9♣ 7♠ (737424) ties: (34810)
///  K♦ 6♣ (675469) K♣ 5♣ (446736) ties: (590099)
///  K♦ 6♣ (675469) K♣ 5♣ (446736) ties: (590099)
///  J♠ T♣ (1250719) T♠ 3♥ (366597) ties: (94988)
///  J♠ T♣ (1250719) T♠ 3♥ (366597) ties: (94988)
///  A♠ 5♣ (987183) Q♣ 9♠ (716153) ties: (8968)
///  A♦ 7♦ (1015715) Q♥ 9♦ (688562) ties: (8027)
///  A♠ 5♥ (1106907) 7♠ 3♥ (595469) ties: (9928)
///  A♠ 5♥ (1106907) 7♠ 3♥ (595469) ties: (9928)
///  9♥ 9♣ (1373694) 6♠ 6♦ (328898) ties: (9712)
///  8♥ 4♥ (1059467) 6♣ 2♥ (569343) ties: (83494)
///  8♥ 4♥ (1059467) 6♣ 2♥ (569343) ties: (83494)
///  A♠ A♦ (1399598) 4♠ 4♦ (303864) ties: (8842)
///  Q♣ 4♥ (968766) 9♣ 6♥ (726117) ties: (17421)
///  K♦ 6♦ (1118226) T♠ 5♥ (583117) ties: (10961)
///  K♦ 6♦ (1118226) T♠ 5♥ (583117) ties: (10961)
///  A♣ J♦ (1038514) K♥ 3♥ (665888) ties: (7902)
///  K♥ 4♠ (1078715) J♠ 3♣ (620573) ties: (13016)
///  K♥ 4♠ (1078715) J♠ 3♣ (620573) ties: (13016)
///  A♥ J♣ (1232835) J♥ 4♥ (442912) ties: (36557)
///  A♥ J♣ (1232835) J♥ 4♥ (442912) ties: (36557)
///  Q♥ T♣ (1052081) 5♣ 3♣ (643417) ties: (16806)
///  Q♥ T♣ (1052081) 5♣ 3♣ (643417) ties: (16806)
///  K♠ J♦ (1092423) Q♣ 9♦ (608301) ties: (11580)
///  K♠ J♦ (1092423) Q♣ 9♦ (608301) ties: (11580)
///  Q♦ T♠ (1119737) 4♥ 2♣ (576599) ties: (15968)
///  K♦ 9♠ (1076054) K♣ 8♦ (380770) ties: (255480)
///  K♠ 3♦ (12668) K♦ 3♠ (12668) ties: (1686968)
///  9♠ 8♥ (1142092) 7♦ 3♣ (520410) ties: (49802)
///  A♦ 3♣ (985001) 7♦ 5♠ (718299) ties: (9004)
///  T♠ 9♠ (1101857) T♥ 5♦ (358881) ties: (251566)
///  9♠ 9♦ (37216) 9♥ 9♣ (37216) ties: (1637872)
///  8♠ 7♣ (850670) 8♥ 6♣ (378138) ties: (483496)
///  8♠ 7♣ (850670) 8♥ 6♣ (378138) ties: (483496)
///  9♣ 6♦ (1086470) 7♦ 6♠ (458254) ties: (167580)
///  T♦ 7♥ (1155769) 7♦ 5♣ (423371) ties: (133164)
///  T♦ 7♥ (1155769) 7♦ 5♣ (423371) ties: (133164)
///  A♣ 7♦ (1270525) K♥ 7♣ (390225) ties: (51554)
///  A♣ 7♦ (1270525) K♥ 7♣ (390225) ties: (51554)
///  T♦ 7♣ (1155683) 7♥ 5♦ (423576) ties: (133045)
///  T♦ 7♣ (1155683) 7♥ 5♦ (423576) ties: (133045)
///  4♠ 4♦ (36730) 4♥ 4♣ (36730) ties: (1638844)
///  K♣ 7♣ (551326) 9♠ 9♦ (1154670) ties: (6308)
///  K♣ 8♥ (1093675) 4♣ 3♦ (605602) ties: (13027)
///  Q♦ 6♠ (1034692) 9♦ 3♦ (660877) ties: (16735)
///  Q♣ 6♥ (1151766) 8♥ 6♠ (484997) ties: (75541)
///  Q♣ 6♥ (1151766) 8♥ 6♠ (484997) ties: (75541)
///  A♠ K♣ (1071020) 5♠ 4♣ (631354) ties: (9930)
///  A♣ J♦ (1063322) K♣ 3♣ (639673) ties: (9309)
///  A♣ J♦ (1063322) K♣ 3♣ (639673) ties: (9309)
///  K♥ K♦ (1369728) 9♠ 9♣ (337204) ties: (5372)
///  K♥ K♦ (1369728) 9♠ 9♣ (337204) ties: (5372)
///  J♣ 8♠ (1062837) 9♥ 7♣ (627073) ties: (22394)
///  J♣ 8♠ (1062837) 9♥ 7♣ (627073) ties: (22394)
///  J♥ 8♠ (979201) J♣ 4♥ (378671) ties: (354432)
///  J♥ 8♠ (979201) J♣ 4♥ (378671) ties: (354432)
///  Q♥ 6♠ (1000886) J♣ 7♦ (697475) ties: (13943)
///  Q♥ 6♠ (1000886) J♣ 7♦ (697475) ties: (13943)
///  J♦ 7♥ (1103091) 8♣ 3♥ (585864) ties: (23349)
///  A♥ 4♦ (958231) 7♣ 6♥ (746137) ties: (7936)
///  A♦ Q♣ (1013988) 5♥ 3♥ (690040) ties: (8276)
///  A♦ Q♣ (1013988) 5♥ 3♥ (690040) ties: (8276)
///  Q♥ 8♠ (1095600) 7♥ 5♠ (599235) ties: (17469)
///  A♦ A♣ (1441209) K♦ 5♦ (263096) ties: (7999)
///  A♦ A♣ (1441209) K♦ 5♦ (263096) ties: (7999)
///  K♦ 5♥ (1086297) J♥ 4♦ (612503) ties: (13504)
///  K♦ 5♥ (1086297) J♥ 4♦ (612503) ties: (13504)
///  A♠ T♣ (1098125) 5♣ 3♦ (605435) ties: (8744)
///  A♠ T♣ (1098125) 5♣ 3♦ (605435) ties: (8744)
///  K♦ 3♦ (1056764) Q♣ 5♠ (643543) ties: (11997)
///  K♦ 3♦ (1056764) Q♣ 5♠ (643543) ties: (11997)
///  A♥ J♠ (738885) T♠ T♥ (965588) ties: (7831)
///  A♥ J♠ (738885) T♠ T♥ (965588) ties: (7831)
///  J♥ 3♦ (1085121) T♠ 2♥ (602241) ties: (24942)
///  J♥ 3♦ (1085121) T♠ 2♥ (602241) ties: (24942)
///  K♥ T♣ (1207789) T♥ 4♥ (443668) ties: (60847)
///  K♥ T♣ (1207789) T♥ 4♥ (443668) ties: (60847)
///  T♥ T♣ (1388646) 9♠ 9♦ (316420) ties: (7238)
///  Q♣ 7♠ (1074983) 9♥ 3♦ (622018) ties: (15303)
///  J♥ 7♠ (1099658) 8♠ 3♥ (587948) ties: (24698)
///  K♠ 3♥ (964641) J♠ 5♠ (734007) ties: (13656)
///  K♠ 3♥ (964641) J♠ 5♠ (734007) ties: (13656)
///  Q♥ 6♦ (712867) Q♣ 2♠ (381863) ties: (617574)
///  K♣ J♦ (1279599) J♥ 3♣ (378072) ties: (54633)
///  K♣ J♦ (1279599) J♥ 3♣ (378072) ties: (54633)
///  Q♦ 5♠ (1137331) 5♣ 4♥ (491912) ties: (83061)
///  A♠ 8♦ (954608) J♣ T♠ (750853) ties: (6843)
///  A♥ 8♦ (970874) 9♠ 7♠ (735176) ties: (6254)
///  Q♣ 4♠ (1180485) 7♦ 4♥ (462631) ties: (69188)
///  A♠ J♥ (37212) A♦ J♣ (37212) ties: (1637880)
///  9♣ 2♦ (524320) 3♠ 3♣ (1150142) ties: (37842)
///  9♣ 2♦ (524320) 3♠ 3♣ (1150142) ties: (37842)
///  9♦ 4♣ (998511) 5♠ 3♣ (657814) ties: (55979)
///  9♦ 4♣ (998511) 5♠ 3♣ (657814) ties: (55979)
///  T♦ 8♣ (1030516) 7♠ 5♠ (650505) ties: (31283)
///  T♦ 8♣ (1030516) 7♠ 5♠ (650505) ties: (31283)
///  A♣ 3♣ (918494) 8♥ 7♥ (785567) ties: (8243)
///  A♣ 3♣ (918494) 8♥ 7♥ (785567) ties: (8243)
///  K♣ 7♠ (1064582) 4♣ 2♣ (634350) ties: (13372)
///  K♣ 7♠ (1064582) 4♣ 2♣ (634350) ties: (13372)
///  Q♥ Q♣ (1403115) 8♠ 7♣ (303362) ties: (5827)
///  Q♥ Q♣ (1403115) 8♠ 7♣ (303362) ties: (5827)
///  K♥ 7♦ (956240) T♥ 9♠ (745283) ties: (10781)
///  Q♦ 9♠ (1224999) 9♥ 5♠ (409298) ties: (78007)
///  K♥ 6♣ (1085441) J♦ 3♣ (615082) ties: (11781)
///  K♥ 6♣ (1085441) J♦ 3♣ (615082) ties: (11781)
///  Q♥ 5♣ (1034841) 9♥ 3♥ (659935) ties: (17528)
///  K♥ K♣ (1364648) 6♠ 6♦ (342914) ties: (4742)
///  T♥ 4♥ (957190) 8♠ 7♥ (721531) ties: (33583)
///  A♠ 5♣ (514438) 8♦ 8♣ (1191212) ties: (6654)
///  Q♣ 6♣ (1143966) 5♠ 2♦ (551322) ties: (17016)
///  Q♣ 6♣ (1143966) 5♠ 2♦ (551322) ties: (17016)
///  T♣ 7♦ (1108218) 9♠ 3♣ (569698) ties: (34388)
///  T♣ 7♦ (1108218) 9♠ 3♣ (569698) ties: (34388)
///  K♣ J♠ (1136738) Q♣ 3♠ (561955) ties: (13611)
///  K♣ J♠ (1136738) Q♣ 3♠ (561955) ties: (13611)
///  K♦ 6♦ (1169807) 6♥ 3♥ (478935) ties: (63562)
///  K♠ 8♦ (1165842) 9♣ 8♠ (496568) ties: (49894)
///  Q♥ 2♦ (915247) J♠ 7♠ (780548) ties: (16509)
///  K♥ 9♥ (1096807) 5♠ 4♥ (602314) ties: (13183)
///  K♥ 9♥ (1096807) 5♠ 4♥ (602314) ties: (13183)
///  A♠ 7♥ (1090527) T♠ 5♦ (614366) ties: (7411)
///  Q♠ 4♦ (973068) T♥ 7♣ (724344) ties: (14892)
///  Q♥ Q♦ (1475262) 3♥ 2♦ (227565) ties: (9477)
///  Q♥ Q♦ (1475262) 3♥ 2♦ (227565) ties: (9477)
///  J♥ 6♣ (1117344) 4♥ 2♣ (569344) ties: (25616)
///  Q♥ 6♠ (716231) Q♦ 3♥ (373121) ties: (622952)
///  J♣ 2♥ (1208911) 7♥ 2♦ (420067) ties: (83326)
///  J♣ 2♥ (1208911) 7♥ 2♦ (420067) ties: (83326)
///  9♣ 3♣ (998492) 4♦ 2♦ (663253) ties: (50559)
///  9♣ 3♣ (998492) 4♦ 2♦ (663253) ties: (50559)
///  Q♥ 9♠ (1118467) T♦ 3♥ (577752) ties: (16085)
///
/// Process finished with exit code 0
/// ```
fn main() {
    let conn = Connection::open("generated/hups.db").unwrap();
    HUPResult::create_table(&conn).unwrap();

    let hups = select_all(&conn);
    for hup in hups {
        println!("{hup}");
    }
}

fn select_all(conn: &Connection) -> Vec<HUPResult> {
    log::debug!("HUPResult::select_all({:?})", conn);

    let mut stmt = conn
        .prepare(
            "SELECT * FROM nlh_headsup_result",
        )
        .ok().unwrap();

    let mut r: Vec<HUPResult> = Vec::new();
    let mut hups = stmt.query({}).unwrap();
    while let Some(row) = hups.next().unwrap() {
        let higher: u64 = row.get(1).unwrap();
        let lower: u64 = row.get(2).unwrap();
        let higher_wins: u64 = row.get(3).unwrap();
        let lower_wins: u64 = row.get(4).unwrap();
        let ties: u64 = row.get(5).unwrap();
        let hup = HUPResult {
            higher: Bard::from(higher),
            lower: Bard::from(lower),
            higher_wins,
            lower_wins,
            ties,
        };
        r.push(hup)
    }
    r
}

// OK, so these results are completely foobared.

